search:
  samples: 1
  nodes: 1
  node_types: 'pascal,volta'

  # doesnt really work to have different cpu counts as tune.run(..., resources_per_trial={"cpu":...}) needs to be set
  node_type_cpus: '5,5'
  grace_period: 0
  reduction_factor: 0
  username: ''
  keyfile: ''
  proxy: ''
  host: ''
  port: 0

training:
  name: 'v0'
  cache: 'cache'
  output: 'output'
  batch_size: !h_int 16
  batch_mem: 32000
  gpu: 1
  epochs: 25
  print_freq: 5
  test_freq: 1
  save_freq: 1
  resume: null
  evaluate: 0
  pretrained: ''
  early_stopping: 5
  reduced_precision: 0
  auto_lr_find: 0
  deterministic: 1

model:
  arch: 'ap-own_vgg'
  in_channels: !h_int 1
  det_hidden_ch: !h_int 128
  qlt_hidden_ch: !h_int 128
  des_hidden_ch: !h_int 128
  descriptor_dim: !h_int 128
  width_mult: !h_float 1.0
  dropout: !h_float 0.0
  batch_norm: 1
  direct_detection: 0
  pretrained: 0
  cache_dir: 'cache'

loss:
  wdt: !h_float -1.0      # weight for peakiness and cosim losses
  wap: !h_float -1.0      # weight for expected ap loss
  det_n: !h_int  16       # detector neighbourhood size
  base: !h_float 0.3     # quality loss target mAP
  nq: 20          # quantizer bins for ap calc
  sampler:        # was for a descriptor head that is same resolution than input image of size [192, 192]
    ngh: 4        # was 7       # neighbourhood size in descriptor cells
    subq: -3      # was -8      # grid step size for positive samples
    subd: 1       # was 1       # neigbourhood sampling interval
    pos_d: 1      # was 2       # positive samples generated up to this far from ideal location
    neg_d: 3      # was 5       # negative samples generated starting from distance from ideal location
    border: 4     # was 16
    subd_neg: -6  # was -8      # grid step size for generating additional negative samples
    max_neg_b: 4                # distractors mined from max this number of images from same batch
    maxpool_pos: 1              # False: use all positive samples, or True: only the best matching one

optimizer:
  method: 'adam'
  learning_rate: !h_float 3e-4
  weight_decay: !h_float 1e-5
  split_params: 0
  eps: !!float 1e-8

data:
  max_rot: !h_float 10.0     # in degrees, synth pair warp related
  max_shear: !h_float 0.2    # synth pair warp related
  max_proj: !h_float 0.7     # synth pair warp related
  noise_max: !h_float 0.10
  rnd_gain: !h_float 1.5
  image_size: !h_int 224
  path: 'data'
  npy: 'false'
  trn_ratio: 0.8
  val_ratio: 0.1
  tst_ratio: 0.1
  workers: 6
